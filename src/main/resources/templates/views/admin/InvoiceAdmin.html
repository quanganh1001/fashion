<!doctype html>
<html lang="en">

<head th:include="~{admin/fragment/head::head}"></head>
<style>
    .hidden {
        display: none;
    }

    i:hover {
        background-color: grey;

    }

    i {
        margin: 5px;
    }

    .info-box {
        display: flex;
    }

    .row {
        width: 100%;
        border: 1px solid black;
        margin: 5px;
    }

    .btn {
        background-color: grey;
        margin: 10px 2px;
        padding: 10px;
    }

</style>
<body>
<div class="ui-menu-item-wrapper">
    <div th:include="~{admin/fragment/Menu::menu}"></div>

    <div class="container mt-5">
        <h2>DANH SÁCH ĐƠN HÀNG</h2>
        <div class="row">
            <a href="/admin/invoice/filter/-1?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box">
                    <span class="info-box-icon"><i class="fa-2xl fa-solid fa-file-invoice-dollar"
                                                   style="color: #000000;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Tất cả đơn hàng</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/0?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box ">
                    <span class="info-box-icon"><i class="fa-2xl fa-solid fa-xmark" style="color: #ff0000;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn đã hủy</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/1?key=" class="btn col-md-2 col-sm-6 col-12">
                <div class="info-box">
                    <span
                            class="info-box-icon"><i class="fa-2xl fa-solid fa-cart-plus"
                                                     style="color: #005eff;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn mới</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/2?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box">
                    <span class="info-box-icon"><i class="fa-2xl fa-solid fa-check"
                                                   style="color: #00800f;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn đã lên</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/3?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box">
                    <span
                            class="info-box-icon"><i class="fa-2xl fa-solid fa-truck-fast" style="color: #ffc800;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn đang giao</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/4?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box ">
                    <span class="info-box-icon"><i class="fa-2xl fa-solid fa-circle-check"
                                                   style="color: #0045bd;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn thành công</div>
                    </div>
                </div>
            </a>

            <a href="/admin/invoice/filter/5?key=" class="btn col-md-3 col-sm-6 col-12">
                <div class="info-box ">
                    <span
                            class="info-box-icon"><i class="fa-2xl fa-solid fa-ban"
                                                     style="color: #ff0000;"></i></span>
                    <div class="info-box-content">
                        <div class="info-box-text" style="color: white">Đơn hoàn</div>
                    </div>
                </div>
            </a>
        </div>

        <form th:action="@{/admin/invoice/filter/__${filterStatus}__}" method="get">
            <label for="key">Tìm kiếm:</label>
            <input type="text" id="key" name="key" th:value="${#strings.isEmpty(searchKey) ? '' : searchKey}"
                   placeholder="Nhập SĐT khách hàng hoặc mã đơn hàng...">
            <button type="submit" class="btn-primary">Tìm kiếm</button>
        </form>

        <div>Tổng: <span th:text="${totalItems}" style="color:red"></span> đơn hàng</div>
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item" th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">
                    <a class="page-link"
                       th:href="@{/admin/invoice/filter/__${filterStatus}__(page=${currentPage}-1,key=${key})}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                    <a class="page-link"
                       th:href="@{/admin/invoice/filter/__${filterStatus}__(page=${i >= 0 ? i : 0},key=${key})}"
                       th:text="${i + 1}"
                       th:class="${currentPage == i} ? 'page-link active' : 'page-link'"
                    ></a>
                </li>
                <li class="page-item" th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">
                    <a class="page-link"
                       th:href="@{/admin/invoice/filter/__${filterStatus}__(page=${currentPage+1},key=${key})}"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>

        <table>
            <thead>
            <tr>
                <th>Mã đơn hàng</th>
                <th>Tên khách hàng</th>
                <th>Số điện thoại</th>
                <th>Địa chỉ</th>
                <th>Tổng đơn hàng</th>
                <th>Ngày đặt hàng</th>
                <th>Ghi chú nội bộ</th>
                <th>Trạng thái</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="invoice:${invoice}">
                <td th:text="${invoice.invoiceId}"></td>
                <td th:text="${invoice.name}"></td>
                <td th:text="${invoice.phone}"></td>
                <td th:text="${invoice.address}"></td>
                <td th:text="${invoice.totalAmount}"></td>
                <td th:text="${invoice.createdAt}"></td>
                <!--                <td th:text="${invoice.note}"></td>-->
                <td>
                    <div class="editable-note">
                        <span th:id="'note' + ${invoice.invoiceId}" th:text="${invoice.note}"></span>
                        <input class="hidden"
                               th:id="'input' + ${invoice.invoiceId}"
                               type="text"
                               th:value="${invoice.note}"/>
                        <span
                                th:id="'edit' + ${invoice.invoiceId}"
                                th:data-invoice-id="${invoice.invoiceId}"
                                onclick="toggleEditMode(this)">
                            <i class="fa-regular fa-pen-to-square" style="color: #0033ff;"></i>
                        </span>
                        <span class="hidden"
                              th:id="'done' + ${invoice.invoiceId}"
                              th:data-invoice-id="${invoice.invoiceId}"
                              onclick="saveNote(this)">
                            <i class="fa-solid fa-check" style="color: #00ff59;"></i>
                        </span>
                        <span class="hidden"
                              th:id="'cancel' + ${invoice.invoiceId}"
                              th:data-invoice-id="${invoice.invoiceId}"
                              onclick="toggleEditMode(this)">
                            <i class="fa-solid fa-xmark" style="color: #ff0000;"></i>
                        </span>
                    </div>
                </td>
                <td>
                    <select class="form-control"
                            th:data-invoice-id="${invoice.invoiceId}"
                            th:data-old-status="${invoice.invoiceStatus.statusId}"
                            onchange="changeStatus(this.value,this.getAttribute('data-invoice-id'))">
                        <option th:each="s : ${status}"
                                th:value="${s.statusId}"
                                th:text="${s.status}"
                                th:selected="${s.statusId == invoice.invoiceStatus.statusId}">
                        </option>
                    </select>
                </td>
                <td><a th:href="@{/admin/invoiceDetail/__${invoice.invoiceId}__}"><i class="fa-regular fa-eye"></i></a></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
</div>
<script th:src="@{/script/InvoiceAdminScript.js}"></script>

</body>
</html>
<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head th:include="~{web/component/head::head}"></head>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css"/>
<style>
    .disable {
        background-color: grey;
    }
</style>
<body>

<header th:include="~{web/component/header::header}"></header>

<div class="mainWrapper--content">
    <div class="layout-collections">
        <div class="header-banner">
            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                    <li class="breadcrumb-item " aria-current="page">
                        <a th:href="@{/category/__${product.category.catId}__}"
                           th:text="${product.category.catName}">
                        </a>
                    </li>
                    <li class="breadcrumb-item" th:text="${product.productName}">
                    </li>
                </ol>
            </nav>
        </div>

        <div class="container d-flex">
            <!-- slide -->
            <div class="a-product-slider col-3 justify-content-center">
                <div class="a-item" th:each="img : ${imgProducts}">
                    <img th:src="@{/products/img?fileImg=__${img.fileImg}__}" class="d-block"
                         style="max-height: 50vh;border: 1px solid"
                         alt="...">
                </div>
            </div>

            <div class="col-9 p-3">
                <h4 id="productName" th:text="${product.productName}"></h4>
                <div id="detail" th:include="~{web/component/ProductDetail::ProductDetail}"></div>
                <div style="background-color: #d9d7d7" class="p-3">
                    <span>Giá:
                        <span id="price" th:if="${!product.isDiscount}" th:text="${product.price}"
                              class="text-danger fw-bold"></span>
                        <div th:unless="${!product.isDiscount}">
                            <span th:text="${product.price} + 'đ'" style="text-decoration: line-through;"></span>
                            <span id="discountPrice" th:text="${product.discountPrice}" class="text-danger fw-bold"></span>
                        </div>
                    </span>
                </div>
                <div class="p-3">
                    <form action="" id="form">
                        <div class="d-flex align-items-center">
                            <div class="col-1">Màu sắc:</div>
                            <div th:each="color, status : ${colors}">
                                <label th:text="${color.name}"
                                       th:data-color-id="${color.colorId}"
                                       th:data-product-id="${product.productId}"
                                       class="color m-2 border p-2"
                                       th:classappend="${status.index == 0} ? 'bg-success text-light checkedColor' : ''">
                                    <input type="radio" name="color"
                                           th:value="${color.colorId}"
                                           th:id="${color.colorId}"
                                           th:checked="${status.index == 0}"
                                           class="hidden"/>
                                </label>
                            </div>
                        </div>

                        <div class="d-flex align-items-center">
                            <div class="col-1">Size:</div>
                            <div th:include="web/component/SelectSize::SelectSize"></div>
                        </div>

                        <div class="mt-3">
                            <label class="col-1">Số lượng: </label>
                            <input id="quantity" class="col-1 m-1 p-1" type="number" value="1" min="1" max="99">
                        </div>

                        <div class="mt-5">
                            <span class="btn p-3 disable border " id="no-submit">Thêm vào giỏ hàng</span>
                            <button type="button" class="btn btn-primary p-3 hidden" id="submit" >Thêm vào giỏ hàng</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.a-product-slider').slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            autoplay: true,
            autoplaySpeed: 5000,
            infinite: true,
            arrows: false,
            responsive: [
                {
                    breakpoint: 800,
                    settings: {
                        slidesToShow: 3
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 3
                    }
                }
            ]
        });

        $('.color').click(function (event) {
            $("#quantity").val(1)
            const productDetail = $("#productDetail-code").val()
            const quantity = $("#quantity").val();

            if (quantity > 0 && productDetail != null){
                $("#submit").removeClass("hidden")
                $("#no-submit").addClass("hidden")
            }else {
                $("#no-submit").removeClass("hidden")
                $("#submit").addClass("hidden")
            }

            // Loại bỏ lớp 'bg-success' từ tất cả các label
            $('.color').removeClass('bg-success text-light checkedColor');

            // Thêm lớp 'bg-success' cho label được bấm vào
            $(this).addClass('bg-success text-light checkedColor');

            // Tìm input con và thay đổi trạng thái checked
            var input = $(this).find('input[name="color"]');
            input.prop('checked', true);

            var colorId = event.currentTarget.getAttribute("data-color-id");
            var productId = event.currentTarget.getAttribute("data-product-id");

            $.ajax({
                type: 'GET',
                url: "/products/detail",
                data: {colorId: colorId, productId: productId},
                success: function (data) {
                    $("#detail").html(data)
                },
                error: (jqXHR) => {
                    alert(jqXHR.responseText)
                }
            });

            $.ajax({
                type: 'GET',
                url: "/products/size",
                data: {colorId: colorId, productId: productId},
                success: function (data) {
                    $("#selectSize").html(data)
                },
                error: (jqXHR) => {
                    alert(jqXHR.responseText)
                }
            });

        });


        $("#quantity").keyup(() => {
            const productDetail = $("#productDetail-code").val();
            const quantity = $("#quantity").val();
            if (quantity > 0 && productDetail != null) {
                $("#submit").removeClass("hidden")
                $("#no-submit").addClass("hidden")
            } else {
                $("#no-submit").removeClass("hidden")
                $("#submit").addClass("hidden")
            }
        })

        $("#submit").click(()=>{
            const quantity = $("#quantity").val();
            const prDetailId = $("#productDetail-id").text()

            $.ajax({
                type: 'POST',
                url: "/carts",
                data: {prDetailId:prDetailId,quantity:quantity},
                success:  (()=> {
                    alert("Đã thêm vào giỏ hàng")
                }),
                error: (jqXHR) => {
                    alert(jqXHR.responseText)
                }
            });
        })
    });
</script>
</body>
</html>